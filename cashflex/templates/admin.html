{% extends 'base.html' %}
{% block content %}

<div class="container mt-4 mb-5">
  <h2 class="text-center text-danger fw-bold mb-4">üìä Painel Administrativo</h2>

  <!-- Estat√≠sticas -->
  <div class="row g-3 mb-4">
    <div class="col-6 col-lg-3">
      <div class="card shadow-lg border-0 text-center bg-light rounded-3 h-100">
        <div class="card-body">
          <h6 class="text-muted">Usu√°rios</h6>
          <h3 class="fw-bold text-primary">{{ total_users }}</h3>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card shadow-lg border-0 text-center bg-light rounded-3 h-100">
        <div class="card-body">
          <h6 class="text-muted">Investido</h6>
          <h3 class="fw-bold text-success">{{ total_investido }} AOA</h3>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card shadow-lg border-0 text-center bg-light rounded-3 h-100">
        <div class="card-body">
          <h6 class="text-muted">Retirado</h6>
          <h3 class="fw-bold text-danger">{{ total_sacado }} AOA</h3>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card shadow-lg border-0 text-center bg-light rounded-3 h-100">
        <div class="card-body">
          <h6 class="text-muted">Em Circula√ß√£o</h6>
          <h3 class="fw-bold text-warning">{{ saldo_total }} AOA</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <ul class="nav nav-pills justify-content-center mb-3" id="adminTab" role="tablist">
    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#users">üë§ Usu√°rios</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#withdrawals">üí∏ Retiradas</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#investments">üìë Investimentos</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#deposits">üè¶ Dep√≥sitos</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#plans">üìã Planos</a></li>
  </ul>

  <div class="tab-content mt-3">

    <!-- Usu√°rios -->
    <div class="tab-pane fade show active" id="users">
      <form method="GET" class="mb-3 d-flex">
        <input type="text" name="search" class="form-control me-2" placeholder="Buscar por telefone" value="{{ request.args.get('search', '') }}">
        <button class="btn btn-outline-primary" type="submit">üîç Buscar</button>
      </form>
      <div class="table-responsive shadow-sm rounded">
        <table class="table table-hover align-middle">
          <thead class="table-dark">
            <tr>
              <th>ID</th><th>Telefone</th><th>Saldo</th><th>C√≥digo</th>
              <th>Banco</th><th>IBAN</th><th>Titular</th>
            </tr>
          </thead>
          <tbody>
            {% for u in users %}
            <tr>
              <td>{{ u.id }}</td>
              <td>{{ u.phone }}</td>
              <td><span class="badge bg-success">Kz {{ u.balance }}</span></td>
              <td>{{ u.invite_code }}</td>
              <td>{{ u.bank or 'N/A' }}</td>
              <td>{{ u.iban or 'N/A' }}</td>
              <td>{{ u.iban_owner or 'N/A' }}</td>
            </tr>
            {% else %}
            <tr><td colspan="7" class="text-center text-muted">Nenhum usu√°rio encontrado</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Retiradas -->
    <div class="tab-pane fade" id="withdrawals">
      <div class="table-responsive shadow-sm rounded">
        <table class="table table-hover align-middle">
          <thead class="table-dark">
            <tr>
              <th>ID</th><th>Usu√°rio</th><th>Valor</th><th>Status</th>
              <th>Banco</th><th>IBAN</th><th>Titular</th><th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            {% for w in withdrawals %}
            <tr>
              <td>{{ w.id }}</td>
              <td>{{ w.user_id }}</td>
              <td><span class="badge bg-info">Kz {{ w.amount }}</span></td>
              <td>
                <span class="badge 
                  {% if w.status == 'Pendente' %}bg-warning
                  {% elif w.status == 'Aprovado' %}bg-success
                  {% else %}bg-danger{% endif %}">
                  {{ w.status }}
                </span>
              </td>
              <td>{{ w.user.bank or 'N/A' }}</td>
              <td>{{ w.user.iban or 'N/A' }}</td>
              <td>{{ w.user.iban_owner or 'N/A' }}</td>
              <td>
                {% if w.status == "Pendente" %}
                  <form action="{{ url_for('admin.approve_withdraw', id=w.id) }}" method="post" class="d-inline">
                    {{ simple_action_form.hidden_tag() }}
                    <button type="submit" class="btn btn-success btn-sm">‚úîÔ∏è</button>
                  </form>
                  <form action="{{ url_for('admin.reject_withdraw', id=w.id) }}" method="post" class="d-inline">
                    {{ simple_action_form.hidden_tag() }}
                    <button type="submit" class="btn btn-danger btn-sm">‚ùå</button>
                  </form>
                {% else %}
                  <span class="text-muted">--</span>
                {% endif %}
              </td>
            </tr>
            {% else %}
            <tr><td colspan="8" class="text-center text-muted">Nenhum saque registrado</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Demais abas (Investimentos, Dep√≥sitos, Planos) continuam como no teu c√≥digo,
         s√≥ aplicar o mesmo estilo de tabela com `table-hover shadow-sm rounded` e badges -->

  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}